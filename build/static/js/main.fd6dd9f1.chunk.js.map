{"version":3,"sources":["icons/point.png","icons/point2.png","icons/plane.png","react-leaflet-icon.js","index.js"],"names":["Point","L","icon","iconUrl","point","iconSize","Point2","point2","Plane","plane","socket","io","path","App","chatContainer","React","createRef","state","userName","isLoggedIn","messages","flights","positions","planes","p2","fp","onButtonClicked","value","c","Date","toString","emit","name","date","message","document","getElementById","buttonUsernameClicked","setState","scrollToMyRef","scroll","current","scrollHeight","clientHeight","scrollTo","on","console","log","connected","data","map","flight","push","origin","code","p","position","toLocaleString","hour","parseInt","slice","final","replace","Fragment","className","MapContainer","center","zoom","scrollWheelZoom","TileLayer","attribution","url","this","Marker","Polyline","smoothFactor","destination","Popup","airline","passengers","ref","msg","id","placeholder","type","onClick","aria-label","aria-describedby","Component","ReactDOM","render"],"mappings":"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","file":"static/js/main.fd6dd9f1.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/point.ae993290.png\";","export default __webpack_public_path__ + \"static/media/point2.ba3c7903.png\";","export default __webpack_public_path__ + \"static/media/plane.31d92501.png\";","import point from './icons/point.png';\nimport point2 from './icons/point2.png';\nimport plane from './icons/plane.png';\nimport L from 'leaflet';\n\nexport const Point = L.icon({\n  iconUrl: point,\n  iconSize: [15 , 15]\n});\n\nexport const Point2 = L.icon({\n  iconUrl: point2,\n  iconSize: [5 , 5]\n});\n\nexport const Plane = L.icon({\n  iconUrl: plane,\n  iconSize: [45 , 45]\n});","import ReactDOM from 'react-dom';\nimport React, { Component } from 'react';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport { io } from \"socket.io-client\";\nimport './index.css';\nimport {Point, Point2, Plane} from './react-leaflet-icon.js';\nimport { MapContainer, TileLayer, Marker, Popup, Polyline } from 'react-leaflet';\nimport 'leaflet/dist/leaflet.css';\nconst socket = io(\"wss://tarea-3-websocket.2021-1.tallerdeintegracion.cl/\", {\n  path: '/flights'\n});\n\nexport default class App extends Component {\n  chatContainer = React.createRef();\n  state = {\n    userName: '',\n    isLoggedIn: false,\n    messages: [],\n    flights: [],\n    positions: [],\n    planes: [],\n    p2: [],\n    fp: {}\n  }\n\n  onButtonClicked = (value) => {\n    var d = new Date();\n    var c = d.toString();\n    socket.emit(\"CHAT\", {name:this.state.userName, date:c, message:value});\n    document.getElementById('message').value = '';\n  }\n  \n  buttonUsernameClicked = (value) => {\n    this.setState({ isLoggedIn: true, userName: value });\n  }\n\n  componentDidMount() {\n    socket.on(\"connect\", () => {\n      console.log(socket.connected);\n    });\n\n    socket.emit(\"FLIGHTS\");\n    socket.on(\"FLIGHTS\", (data) => {\n      console.log(data);\n      this.setState((state) =>\n        ({flights: data})\n      );\n      var positions = [];\n      var fp = {};\n      var planes = [];\n      var c = 0;\n      data.map( flight => {\n        positions.push(flight.origin);\n        fp[flight.code] = c;\n        planes.push(c);\n        c += 1;\n        return 1;\n        }\n        )\n      this.setState(\n        {\n          positions\n        }\n      );\n      this.setState(\n        {\n          fp\n        }\n      );\n      this.setState(\n        {\n          planes\n        }\n      );\n    });\n\n    socket.on(\"POSITION\", (data) => {\n      var positions = [];\n      this.state.positions.map( p =>\n        positions.push(p)\n        )\n      positions[this.state.fp[data.code]] = data.position;\n      let p2 = [...this.state.p2, data.position];\n      this.setState(\n        {\n          positions\n        }\n      );\n      this.setState(\n        {\n          p2\n        }\n      );\n    });\n\n    socket.on(\"CHAT\", (data) => {\n      var f = new Date(data.date);\n      var c = f.toLocaleString();\n      var hour = (parseInt(c.slice(11,13))).toString()\n      var final = c.slice(0,10).replace(/-/g,\"/\") + ' '+ hour+c.slice(13,16);\n      let messages = [...this.state.messages, {\n        name: data.name,\n        date: final,\n        message: data.message\n      }];\n      if(this.state.isLoggedIn) {\n        this.setState(\n          {\n            messages\n          },\n          () => this.scrollToMyRef()\n        );\n      }\n      else {\n        this.setState(\n          {\n            messages\n          }\n        );\n      }\n      // el html y css del chat me base de aca: https://www.bootdey.com/snippets/view/animated-chat-window#html\n    });\n  }\n\n  scrollToMyRef = () => {\n    const scroll = this.chatContainer.current.scrollHeight - this.chatContainer.current.clientHeight; \n    this.chatContainer.current.scrollTo(0, scroll);\n  };\n  // esta funcion la obtuve de aca: https://codesandbox.io/s/8l2y0o24x9?file=/src/index.js:555-643\n\n  render() {\n    return (\n      <React.Fragment>\n        <div className='fluid-container'>\n          <div className='row'>\n            <div className='col-8'>\n              <h1>Mapa en vivo:</h1>\n              <div className=\"map_box\">\n                <MapContainer center={[0, 0]} zoom={1.4} scrollWheelZoom={true}>\n                  <TileLayer attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors' url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"/>\n                  {this.state.flights.map( flight =>\n                    <Marker position={flight.origin} icon={Point}>\n                      <Polyline smoothFactor={1} positions={[flight.origin, flight.destination]}></Polyline>\n                    </Marker>\n                  )}\n                  {this.state.flights.map( flight =>\n                    <Marker position={flight.destination} icon={Point}></Marker>\n                  )}\n                  {this.state.p2.map( p =>\n                    <Marker position={p} icon={Point2}></Marker>\n                  )}\n                  {this.state.planes.map( plane =>\n                    <Marker position={this.state.positions[plane]} icon={Plane}>\n                      <Popup>\n                        Code: {this.state.flights[plane].code} <br />\n                      </Popup>\n                    </Marker>\n                  )};\n                </MapContainer>\n              </div>\n              <div className=\"space\"></div>\n              <div className=\"flights_box\">\n                <h4>Vuelos:</h4>\n                {this.state.flights.map( flight => \n                  <li key={flight.code}>Code: {flight.code},  Airline: {flight.airline},  Origen: ({flight.origin[0]}, {flight.origin[1]}),  Destino: ({flight.destination[0]}, {flight.destination[1]}),  Plane: {flight.plane}, Passangers: {flight.passengers[0].name}...</li>\n                )}\n              </div>\n            </div>\n            <div className='col-4'>\n              <div>\n              {this.state.isLoggedIn ? \n              <div>\n                <div className='chat_window'>\n                  <div className='top_menu'>\n                    <div className='title'>Centro de Control</div>\n                  </div>\n                  <ul>\n                    <div ref={this.chatContainer} className='Chat'>\n                      {this.state.messages.map( msg => \n                        <li  key={msg.message+msg.date+msg.name}>\n                          <div>\n                            ({msg.date})     {msg.name}: {msg.message}\n                          </div>\n                        </li>\n                        )}\n                    </div>  \n                  </ul>\n                  <div className=\"bottom_wrapper clearfix\">\n                    <div className=\"message_input_wrapper\">\n                      <input id='message' className=\"message_input\" placeholder=\"Escribe algo aquí...\"/>\n                    </div>\n                    <div className=\"send_message\">\n                      <button type=\"button\" className=\"btn btn-outline-primary\" onClick={() => this.onButtonClicked(document.getElementById('message').value)}>Send</button>\n                    </div>\n                  </div>\n                </div>\n              </div>  \n              :\n              <div>\n                <h3>Regístrate para poder chatear!</h3>\n                <div className=\"input-group\">\n                  <input type=\"search\" id='nickname' className=\"form-control rounded\" placeholder=\"Nickname\" aria-label=\"Search\"\n                    aria-describedby=\"search-addon\" />\n                  <button type=\"button\" className=\"btn btn-outline-primary\" onClick={() => this.buttonUsernameClicked(document.getElementById('nickname').value)}>Ingresar</button>\n                </div>\n              </div>  \n              }\n              </div>\n          </div>\n        </div>\n        </div>\n     </React.Fragment> \n    );\n  }\n}    \n\nReactDOM.render(<App />, document.getElementById('root'));"],"sourceRoot":""}