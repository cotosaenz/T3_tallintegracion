{"version":3,"sources":["icons/point.png","icons/plane.png","react-leaflet-icon.js","index.js"],"names":["Point","L","icon","iconUrl","point","iconSize","Plane","plane","socket","io","path","App","chatContainer","React","createRef","state","userName","isLoggedIn","messages","flights","positions","fp","onButtonClicked","value","c","Date","toString","emit","name","date","message","document","getElementById","buttonUsernameClicked","setState","scrollToMyRef","scroll","current","scrollHeight","clientHeight","scrollTo","on","console","log","connected","data","map","flight","l","push","origin","code","p","position","toISOString","hour","parseInt","slice","final","replace","Fragment","className","MapContainer","center","zoom","scrollWheelZoom","TileLayer","attribution","url","this","Marker","Polyline","smoothFactor","destination","pos","Popup","airline","ref","msg","id","placeholder","type","onClick","aria-label","aria-describedby","Component","ReactDOM","render"],"mappings":"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","file":"static/js/main.6b3d722b.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/point.ae993290.png\";","export default __webpack_public_path__ + \"static/media/plane.31d92501.png\";","import point from './icons/point.png';\nimport plane from './icons/plane.png';\nimport L from 'leaflet';\n\nexport const Point = L.icon({\n  iconUrl: point,\n  iconSize: [15 , 15]\n});\n\nexport const Point2 = L.icon({\n  iconUrl: point,\n  iconSize: [5 , 5]\n});\n\nexport const Plane = L.icon({\n  iconUrl: plane,\n  iconSize: [45 , 45]\n});","import ReactDOM from 'react-dom';\nimport React, { Component } from 'react';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport { io } from \"socket.io-client\";\nimport './index.css';\nimport {Point, Point2, Plane} from './react-leaflet-icon.js';\nimport { MapContainer, TileLayer, Marker, Popup, Polyline } from 'react-leaflet';\nimport 'leaflet/dist/leaflet.css';\nconst socket = io(\"wss://tarea-3-websocket.2021-1.tallerdeintegracion.cl/\", {\n  path: '/flights'\n});\n\nexport default class App extends Component {\n  chatContainer = React.createRef();\n  state = {\n    userName: '',\n    isLoggedIn: false,\n    messages: [],\n    flights: [],\n    positions: [],\n    fp: {}\n  }\n\n  onButtonClicked = (value) => {\n    var d = new Date();\n    var c = d.toString();\n    socket.emit(\"CHAT\", {name:this.state.userName, date:c, message:value});\n    document.getElementById('message').value = '';\n  }\n  \n  buttonUsernameClicked = (value) => {\n    this.setState({ isLoggedIn: true, userName: value });\n  }\n\n  componentDidMount() {\n    socket.on(\"connect\", () => {\n      console.log(socket.connected);\n    });\n\n    socket.emit(\"FLIGHTS\");\n    socket.on(\"FLIGHTS\", (data) => {\n      console.log(data);\n      this.setState((state) =>\n        ({flights: data})\n      );\n      var positions = [];\n      var fp = {};\n      var c = 0;\n      data.map( flight => {\n        var l = [];\n        var m = [];\n        l.push(flight.origin);\n        l.push(flight.code);\n        l.push(m);\n        positions.push(l);\n        fp[flight.code] = c;\n        c += 1;\n        return 1;\n        }\n        )\n      this.setState(\n        {\n          positions\n        }\n      );\n      this.setState(\n        {\n          fp\n        }\n      );\n      console.log('posiciones iniciales', this.state.positions);\n      console.log('fp', this.state.fp);\n    });\n\n    socket.on(\"POSITION\", (data) => {\n      var positions = [];\n      this.state.positions.map( p =>\n        positions.push(p)\n        )\n      positions[this.state.fp[data.code]][0] = data.position;\n      positions[this.state.fp[data.code]][2].push(data.position);\n      this.setState(\n        {\n          positions\n        }\n      );\n      console.log('posiciones cambiadas', this.state.positions);\n    });\n\n    socket.on(\"CHAT\", (data) => {\n      var f = new Date(data.date);\n      var c = f.toISOString();\n      var hour = (parseInt(c.slice(11,13)) - 4).toString()\n      var final = c.slice(0,10).replace(/-/g,\"/\") + ' '+ hour+c.slice(13,16);\n      console.log(final);\n      let messages = [...this.state.messages, {\n        name: data.name,\n        date: final,\n        message: data.message\n      }];\n\n      this.setState(\n        {\n          messages\n        },\n        () => this.scrollToMyRef()\n      );\n    });\n  }\n\n  scrollToMyRef = () => {\n    const scroll = this.chatContainer.current.scrollHeight - this.chatContainer.current.clientHeight; \n    this.chatContainer.current.scrollTo(0, scroll);\n  };\n  //https://codesandbox.io/s/8l2y0o24x9?file=/src/index.js:555-643\n\n  render() {\n    return (\n      <React.Fragment>\n        <div className='fluid-container'>\n          <div className='row'>\n            <div className='col-8'>\n              <h1>Mapa en vivo:</h1>\n              <div className=\"map_box\">\n                <MapContainer center={[0, 0]} zoom={1.4} scrollWheelZoom={true}>\n                  <TileLayer attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors' url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"/>\n                  {this.state.flights.map( flight =>\n                    <Marker position={flight.origin} icon={Point}>\n                      <Polyline smoothFactor={1} positions={[flight.origin, flight.destination]}></Polyline>\n                    </Marker>\n                  )}\n                  {this.state.flights.map( flight =>\n                    <Marker position={flight.destination} icon={Point}></Marker>\n                  )}\n                  {this.state.positions.map( pos =>\n                    <Marker position={pos[0]} icon={Plane}>\n                      <Popup>\n                        Code: {pos[1]} <br />\n                      </Popup>\n                    </Marker>\n                  )};\n                </MapContainer>\n              </div>\n              <div className=\"space\"></div>\n              <div className=\"flights_box\">\n                Vuelos:\n                {this.state.flights.map( flight =>\n                  <li key={flight.code}>\n                    Code: {flight.code},  Airline: {flight.airline},  Origen: ({flight.origin[0]}, {flight.origin[1]}),  Destino: ({flight.destination[0]}, {flight.destination[1]}),  Plane: {flight.plane}.\n                  </li>\n                )}\n              </div>\n            </div>\n            <div className='col-4'>\n              <div>\n              {this.state.isLoggedIn ? \n              <div>\n                <div className='chat_window'>\n                  <div className='top_menu'>\n                    <div className='title'>Centro de Control</div>\n                  </div>\n                  <ul>\n                    <div ref={this.chatContainer} className='Chat'>\n                      {this.state.messages.map( msg => \n                        <li  key={msg.message+msg.date+msg.name}>\n                          <div>\n                            ({msg.date})     {msg.name}: {msg.message}\n                          </div>\n                        </li>\n                        )}\n                    </div>  \n                  </ul>\n                  <div className=\"bottom_wrapper clearfix\">\n                    <div className=\"message_input_wrapper\">\n                      <input id='message' className=\"message_input\" placeholder=\"Escribe algo aquí...\"/>\n                    </div>\n                    <div className=\"send_message\">\n                      <button type=\"button\" className=\"btn btn-outline-primary\" onClick={() => this.onButtonClicked(document.getElementById('message').value)}>Send</button>\n                    </div>\n                  </div>\n                </div>\n              </div>  \n              :\n              <div>\n                <h3>Regístrate para poder chatear!</h3>\n                <div className=\"input-group\">\n                  <input type=\"search\" id='nickname' className=\"form-control rounded\" placeholder=\"Nickname\" aria-label=\"Search\"\n                    aria-describedby=\"search-addon\" />\n                  <button type=\"button\" className=\"btn btn-outline-primary\" onClick={() => this.buttonUsernameClicked(document.getElementById('nickname').value)}>Ingresar</button>\n                </div>\n              </div>  \n              }\n              </div>\n          </div>\n        </div>\n        </div>\n     </React.Fragment> \n    );\n  }\n}    \n\nReactDOM.render(<App />, document.getElementById('root'));"],"sourceRoot":""}